import"./modulepreload-polyfill-3cfb730f.js";import{H as F,I as x,B as G,d as S,S as N,J as W,a as v,s as H,q as z,A as B,D as j,P as q,W as J,y as K,g as V}from"./three.module-13a89988.js";import{O as X}from"./OrbitControls-63ae8fc2.js";import{G as Y}from"./lil-gui.esm-1e0f7d72.js";import{G as Q}from"./GLTFLoader-c57b3ea4.js";const C=new WeakMap;class Z extends F{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,r,a,s){const o=new x(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,t=>{this.decodeDracoFile(t,r).catch(s)},a,s)}decodeDracoFile(e,r,a,s){const o={attributeIDs:a||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!a};return this.decodeGeometry(e,o).then(r)}decodeGeometry(e,r){const a=JSON.stringify(r);if(C.has(e)){const d=C.get(e);if(d.key===a)return d.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const o=this.workerNextTaskID++,t=e.byteLength,n=this._getWorker(o,t).then(d=>(s=d,new Promise((m,l)=>{s._callbacks[o]={resolve:m,reject:l},s.postMessage({type:"decode",id:o,taskConfig:r,buffer:e},[e])}))).then(d=>this._createGeometry(d.geometry));return n.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),C.set(e,{key:a,promise:n}),n}_createGeometry(e){const r=new G;e.index&&r.setIndex(new S(e.index.array,1));for(let a=0;a<e.attributes.length;a++){const s=e.attributes[a],o=s.name,t=s.array,n=s.itemSize;r.setAttribute(o,new S(t,n))}return r}_loadLibrary(e,r){const a=new x(this.manager);return a.setPath(this.decoderPath),a.setResponseType(r),a.setWithCredentials(this.withCredentials),new Promise((s,o)=>{a.load(e,s,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",r=[];return e?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_wasm_wrapper.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then(a=>{const s=a[0];e||(this.decoderConfig.wasmBinary=a[1]);const o=$.toString(),t=["/* draco decoder */",s,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([t]))}),this.decoderPending}_getWorker(e,r){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(o){const t=o.data;switch(t.type){case"decode":s._callbacks[t.id].resolve(t);break;case"error":s._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,o){return s._taskLoad>o._taskLoad?-1:1});const a=this.workerPool[this.workerPool.length-1];return a._taskCosts[e]=r,a._taskLoad+=r,a})}_releaseTask(e,r){e._taskLoad-=e._taskCosts[r],delete e._callbacks[r],delete e._taskCosts[r]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function $(){let i,e;onmessage=function(t){const n=t.data;switch(n.type){case"init":i=n.decoderConfig,e=new Promise(function(l){i.onModuleLoaded=function(h){l({draco:h})},DracoDecoderModule(i)});break;case"decode":const d=n.buffer,m=n.taskConfig;e.then(l=>{const h=l.draco,c=new h.Decoder,w=new h.DecoderBuffer;w.Init(new Int8Array(d),d.byteLength);try{const u=r(h,c,w,m),y=u.attributes.map(g=>g.array.buffer);u.index&&y.push(u.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:u},y)}catch(u){console.error(u),self.postMessage({type:"error",id:n.id,error:u.message})}finally{h.destroy(w),h.destroy(c)}});break}};function r(t,n,d,m){const l=m.attributeIDs,h=m.attributeTypes;let c,w;const u=n.GetEncodedGeometryType(d);if(u===t.TRIANGULAR_MESH)c=new t.Mesh,w=n.DecodeBufferToMesh(d,c);else if(u===t.POINT_CLOUD)c=new t.PointCloud,w=n.DecodeBufferToPointCloud(d,c);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!w.ok()||c.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+w.error_msg());const y={index:null,attributes:[]};for(const g in l){const L=self[h[g]];let T,P;if(m.useUniqueIDs)P=l[g],T=n.GetAttributeByUniqueId(c,P);else{if(P=n.GetAttributeId(c,t[l[g]]),P===-1)continue;T=n.GetAttribute(c,P)}y.attributes.push(s(t,n,c,g,L,T))}return u===t.TRIANGULAR_MESH&&(y.index=a(t,n,c)),t.destroy(c),y}function a(t,n,d){const l=d.num_faces()*3,h=l*4,c=t._malloc(h);n.GetTrianglesUInt32Array(d,h,c);const w=new Uint32Array(t.HEAPF32.buffer,c,l).slice();return t._free(c),{array:w,itemSize:1}}function s(t,n,d,m,l,h){const c=h.num_components(),u=d.num_points()*c,y=u*l.BYTES_PER_ELEMENT,g=o(t,l),L=t._malloc(y);n.GetAttributeDataArrayForAllPoints(d,h,g,y,L);const T=new l(t.HEAPF32.buffer,L,u).slice();return t._free(L),{name:m,array:T,itemSize:c}}function o(t,n){switch(n){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}}new Y;const E=document.querySelector("canvas.webgl"),b=new N,O=new Z;O.setDecoderPath("/draco/");const D=new Q;D.setDRACOLoader(O);D.load("/models/Duck/glTF-Draco/Duck.gltf",i=>{console.log(i);const e=[...i.scene.children];for(const r of e)b.add(r)},i=>{console.log("progress",i)},i=>{console.log("error",i)});let A=null;D.load("/models/Fox/glTF/Fox.gltf",i=>{A=new W(i.scene);let e=A.clipAction(i.animations[0]);e.play(),e.clampWhenFinished=!0,A.addEventListener("finished",function(r){console.log(r)}),i.scene.scale.set(.025,.025,.025),i.scene.rotation.y=Math.PI/2,i.scene.position.z+=2,b.add(i.scene)});D.load("/models/面包片.glb",i=>{i.scene.scale.set(.25,.25,.25),i.scene.position.z-=3,b.add(i.scene)});const I=new v(new H(10,10),new z({color:"#444444",metalness:0,roughness:.5}));I.receiveShadow=!0;I.rotation.x=-Math.PI*.5;b.add(I);const ee=new B(16777215,.8);b.add(ee);const p=new j(16777215,.6);p.castShadow=!0;p.shadow.mapSize.set(1024,1024);p.shadow.camera.far=15;p.shadow.camera.left=-7;p.shadow.camera.top=7;p.shadow.camera.right=7;p.shadow.camera.bottom=-7;p.position.set(5,5,5);b.add(p);const f={width:window.innerWidth,height:window.innerHeight};window.addEventListener("resize",()=>{f.width=window.innerWidth,f.height=window.innerHeight,_.aspect=f.width/f.height,_.updateProjectionMatrix(),k.setSize(f.width,f.height),k.setPixelRatio(Math.min(window.devicePixelRatio,2))});const _=new q(75,f.width/f.height,.1,100);_.position.set(2,2,2);b.add(_);const R=new X(_,E);R.target.set(0,.75,0);R.enableDamping=!0;const k=new J({canvas:E});k.shadowMap.enabled=!0;k.shadowMap.type=K;k.setSize(f.width,f.height);k.setPixelRatio(Math.min(window.devicePixelRatio,2));const te=new V;let M=0;const U=()=>{const i=te.getElapsedTime(),e=i-M;M=i,A&&A.update(e),R.update(),k.render(b,_),window.requestAnimationFrame(U)};U();
